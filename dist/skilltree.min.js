!function(n,t){function i(n){for(var t=n.split("."),i=window,e="",o=0,r=t.length;r>o;o++)e=t[o],i[e]=i[e]||{},i=i[e];return i}function e(n){return n.length>2&&(n=[n.slice(0,n.length-1).join(", "),n[n.length-1]]),n.join(" and ")}function o(n){return n?JSON.parse(JSON.stringify(n)):n}t.bindingHandlers.rightClick={init:function(t,i){n(t).on("mousedown",function(n){3==n.which&&i()()}).on("contextmenu",function(n){n.preventDefault()})}},function(n){var i=(n.Calculator=function(n){function e(n){return t.utils.arrayFirst(c.skills(),function(t){return t.id==n})}function r(n){if(n){k=!1,c.newbMode();var i=n.split(p);i[2]&&c.portrait(Number(i[2])),i[3]&&c.avatarName(i[3]);for(var o=i[1],r=[],s=o.split(""),a=0;a<s.length;a++)if(!Number(s[a])){var u=e(s[a].charCodeAt(0)-l);if(u){var d=Number(s[a+1])||1;r.push({skill:u,points:d})}}for(var f=!0;f;)f=!1,t.utils.arrayForEach(r,function(n){!n.wasAllocated&&n.skill.canAddPoints()&&(n.skill.points(Math.min(n.skill.maxPoints,n.points)),n.wasAllocated=!0,f=!0)});k=!0}}function s(){r(f)}function a(n){window.location.hash=n||m}var u=n||{},c=function(){},l=96,p="_",d=u.numPortraits||1;c.isOpen=t.observable(!0),c.open=function(){c.isOpen(!0)},c.close=function(){c.isOpen(!1)},c.toggle=function(){c.isOpen(!c.isOpen())},c.skills=t.observableArray(t.utils.arrayMap(u.skills,function(n){return new i(n,c.skills,u.learnTemplate)})),t.utils.arrayForEach(u.skills,function(n){if(n.dependsOn){var i=e(n.id);t.utils.arrayForEach(n.dependsOn,function(n){var t=e(n);i.dependencies.push(t),t.dependents.push(i)})}}),c.avatarName=t.observable("Your Name"),c.level=t.computed(function(){var n=0;return t.utils.arrayForEach(c.skills(),function(t){n+=t.points()}),n+1}),c.noPointsSpent=t.computed(function(){return!Boolean(t.utils.arrayFirst(c.skills(),function(n){return n.points()>0}))}),c.stats=t.computed(function(){var n=o(u.defaultStats)||{};t.utils.arrayForEach(c.skills(),function(i){var e=i.points();e>0&&t.utils.arrayForEach(i.stats,function(t){var i=n[t.title]||0;i+=t.value*e,n[t.title]=i})});var i=[];for(var e in n)i.push({title:e,value:n[e]});return i}),c.talentSummary=t.computed(function(){var n=[];return t.utils.arrayForEach(c.skills(),function(t){t.hasPoints()&&(n=n.concat(t.talents))}),n.join(", ")}),c.portrait=t.observable(Math.ceil(Math.random()*d)),c.portraitURL=t.computed(function(){return(u.portraitPathTemplate||"img/portraits/portrait-{n}.jpg").replace("{n}",c.portrait())}),c.choosePreviousPortrait=function(){var n=c.portrait()-1;1>n&&(n=d),c.portrait(n)},c.chooseNextPortrait=function(){var n=c.portrait()+1;n>d&&(n=1),c.portrait(n)},c.newbMode=function(){t.utils.arrayForEach(c.skills(),function(n){n.points(0)})},c.godMode=function(){t.utils.arrayForEach(c.skills(),function(n){n.points(n.maxPoints)})},c.hash=t.computed(function(){var n=[];return t.utils.arrayForEach(c.skills(),function(t){t.hasPoints()&&(n.push(String.fromCharCode(t.id+l)),t.hasMultiplePoints()&&n.push(t.points()))}),["",n.join(""),c.portrait(),c.avatarName()].join(p)});var f,h,m,v,k=!0;c.useHash=function(n){f=n,clearTimeout(h),h=setTimeout(s,50)},c.hash.subscribe(function(n){k&&(m=n,clearTimeout(v),v=setTimeout(a,50))}),window.onhashchange=function(){c.useHash(decodeURI(window.location.hash.substr(1)))};var P=decodeURI(window.location.hash.substr(1));return c.isOpen(""!=P),c.useHash(P),c},n.Skill=function(n,i,o){var s=n||{},a=function(){};return a.id=s.id||0,a.title=s.title||"Unknown Skill",a.description=s.description,a.maxPoints=s.maxPoints||1,a.points=t.observable(s.points||0),a.links=t.utils.arrayMap(s.links,function(n){return new r(n)}),a.dependencies=t.observableArray([]),a.dependents=t.observableArray([]),a.stats=s.stats||[],a.rankDescriptions=s.rankDescriptions||[],a.talents=s.talents||[],a.hasDependencies=t.computed(function(){return a.dependencies().length>0}),a.dependenciesFulfilled=t.computed(function(){var n=!0;return t.utils.arrayForEach(a.dependencies(),function(t){t.hasPoints()||(n=!1)}),n}),a.dependentsUsed=t.computed(function(){var n=!1;return t.utils.arrayForEach(a.dependents(),function(t){t.hasPoints()&&(n=!0)}),n}),a.hasPoints=t.computed(function(){return a.points()>0}),a.hasMultiplePoints=t.computed(function(){return a.points()>1}),a.hasMaxPoints=t.computed(function(){return a.points()>=a.maxPoints}),a.canAddPoints=t.computed(function(){return a.dependenciesFulfilled()&&!a.hasMaxPoints()}),a.canRemovePoints=t.computed(function(){return a.dependentsUsed()&&a.hasMultiplePoints()||!a.dependentsUsed()&&a.hasPoints()}),a.helpMessage=t.computed(function(){if(!a.dependenciesFulfilled()){var n=[];return t.utils.arrayForEach(a.dependencies(),function(t){t.hasMaxPoints()||n.push(t.title)}),(o||"Learn {n} to unlock.").replace("{n}",e(n))}return""}),a.talentSummary=t.computed(function(){return a.talents.join(", ")}),a.currentRankDescription=t.computed(function(){return a.rankDescriptions[a.points()-1]}),a.nextRankDescription=t.computed(function(){return a.rankDescriptions[a.points()]}),a.addPoint=function(){a.canAddPoints()&&a.points(a.points()+1)},a.removePoint=function(){a.canRemovePoints()&&a.points(a.points()-1)},a}),r=n.Link=function(n){var t=n||{},i=function(){};return i.label=t.label||t.url||"Learn more",i.url=t.url||"javascript:void(0)",i}}(i("tft.skilltree"))}(window.jQuery,window.ko);